# =============================================================================
# CIA DASHBOARD - CONFIGURAÇÃO BASE
# =============================================================================
# Valores compartilhados entre todos os ambientes.
# Sobrescritos por .env.{environment} e .env.secrets
#
# =============================================================================
# Identificação
# =============================================================================
PROJECT=workspace
ENVIRONMENT=development
PORT_PREFIX=80

# =============================================================================
# Optional Setups
# =============================================================================
POSTGRES_ANALYTICS_AVAILABLE=false
MYSQL_AVAILABLE=false
MSSQL_AVAILABLE=false
MEILISEARCH_AVAILABLE=true
OLLAMA_AVAILABLE=true
N8N_AVAILABLE=false

# =============================================================================
# Servicos Proprios - Portas (XX00-XX49)
# =============================================================================
PORT=${PORT_PREFIX}00
BACKBONE_PORT=${PORT_PREFIX}02
SOCKET_PORT=${PORT_PREFIX}01
WA_SIM_PORT=${PORT_PREFIX}03

# =============================================================================
# Servicos Externos - Portas (XX50-XX99, expostas apenas em dev)
# =============================================================================
POSTGRES_MAIN_PORT=${PORT_PREFIX}50
REDIS_PORT=${PORT_PREFIX}51
MONGO_PORT=${PORT_PREFIX}52
MEILISEARCH_PORT=${PORT_PREFIX}53
N8N_PORT=${PORT_PREFIX}54
EVOLUTION_PORT=${PORT_PREFIX}55
OLLAMA_PORT=${PORT_PREFIX}56
ADMINER_PORT=${PORT_PREFIX}57
POSTGRES_ANALYTICS_PORT=${PORT_PREFIX}58

# =============================================================================
# Portas Internas (dentro da rede Docker)
# =============================================================================
POSTGRES_INTERNAL_PORT=5432
MONGO_INTERNAL_PORT=27017
REDIS_INTERNAL_PORT=6379
MEILISEARCH_INTERNAL_PORT=7700
OLLAMA_INTERNAL_PORT=11434
EVOLUTION_INTERNAL_PORT=8080
N8N_INTERNAL_PORT=5678
ADMINER_INTERNAL_PORT=8080

# =============================================================================
# URLs Publicas (sobrescritas por ambiente)
# =============================================================================
APP_BASE_URL=http://localhost:8000
NEXT_PUBLIC_API_URL=http://cia-api:8001
NEXT_PUBLIC_SOCKET_URL=http://localhost:${SOCKET_PORT}

# =============================================================================
# Rotas internas ao ecossistema
# =============================================================================
APP_INERNAL_URL=http://app.internal:${PORT}
BACKBONE_INERNAL_URL=http://backbone.internal:${BACKBONE_PORT}
SOCKET_INERNAL_URL=http://socket.internal:${SOCKET_PORT}
WA_SIM_INTERNAL_URL=http://wa-sim.internal:${WA_SIM_PORT}

# =============================================================================
# WhatsApp Simulator
# =============================================================================
WA_SIM_URL=http://localhost:${WA_SIM_PORT}
BACKBONE_WEBHOOK_URL=http://localhost:${BACKBONE_PORT}/backbone/whatsapp/webhook

# =============================================================================
# Database - PostgreSQL MAIN (Transacional)
# =============================================================================
# Dual User Pattern: superuser para admin, app user para aplicacao
# POSTGRES_INIT_DB: database criado na inicializacao do container (padrao Postgres)
POSTGRES_INIT_DB=postgres
POSTGRES_MAIN_SUPERUSER=postgres
POSTGRES_MAIN_SUPERUSER_PASSWORD=postgres
POSTGRES_MAIN_USER=admin
POSTGRES_MAIN_PASSWORD=Admin123
POSTGRES_MAIN_DB=cia_main
POSTGRES_MAIN_HOST=postgres-main.internal
POSTGRES_MAIN_URL=postgresql://${POSTGRES_MAIN_USER}:${POSTGRES_MAIN_PASSWORD}@${POSTGRES_MAIN_HOST}:${POSTGRES_INTERNAL_PORT}/${POSTGRES_MAIN_DB}

# =============================================================================
# Database - PostgreSQL ANALYTICS (OLAP - Modelo Estrela)
# =============================================================================
# Base denormalizada, atualizada D-1 (diariamente)
POSTGRES_ANALYTICS_SUPERUSER=postgres
POSTGRES_ANALYTICS_SUPERUSER_PASSWORD=postgres
POSTGRES_ANALYTICS_USER=admin
POSTGRES_ANALYTICS_PASSWORD=Admin123
POSTGRES_ANALYTICS_DB=cia_analytics
POSTGRES_ANALYTICS_HOST=postgres-analytics.internal
POSTGRES_ANALYTICS_URL=postgresql://${POSTGRES_ANALYTICS_USER}:${POSTGRES_ANALYTICS_PASSWORD}@${POSTGRES_ANALYTICS_HOST}:${POSTGRES_INTERNAL_PORT}/${POSTGRES_ANALYTICS_DB}

# =============================================================================
# Database - MongoDB (Documentos, Logs, Analytics)
# =============================================================================
MONGO_USER=admin
MONGO_PASSWORD=Admin123
MONGO_DB=cia_dashboard
MONGO_HOST=mongo.internal
MONGO_URL=mongodb://${MONGO_USER}:${MONGO_PASSWORD}@${MONGO_HOST}:${MONGO_INTERNAL_PORT}/${MONGO_DB}?authSource=admin

# =============================================================================
# Database - MySQL exernal (Legado - EXTERNA)
# =============================================================================
# CRITICAL: READ-ONLY - NUNCA escrever nesta base
# Credenciais em .env.secrets
MYSQL_HOST=
MYSQL_PORT=3306
MYSQL_DB=
# Sobreponha no .env.secrets
MYSQL_USER=
MYSQL_PASS=

# SSH Tunnel (opcional para acesso remoto seguro)
MYSQL_SSH=false
MYSQL_SSH_HOST=
# Sobreponha no .env.secrets
MYSQL_SSH_USER=
MYSQL_SSH_KEY=

# =============================================================================
# Database - SQL Server exernal (Legado - EXTERNA)
# =============================================================================
# CRITICAL: READ-ONLY - NUNCA escrever nesta base
# Credenciais em .env.secrets
MSSQL_HOST=
MSSQL_INSTANCE_NAME=
MSSQL_PORT=1433
MSSQL_DB=
# Sobreponha no .env.secrets
MSSQL_USER=
MSSQL_PASS=

# =============================================================================
# Redis (Cache, Sessions, Queue)
# =============================================================================
REDIS_HOST=redis.internal
REDIS_URL=redis://${REDIS_HOST}:${REDIS_INTERNAL_PORT}
REDIS_PASSWORD=

# =============================================================================
# Meilisearch (Full-text Search)
# =============================================================================
MEILISEARCH_HOST=meilisearch.internal
MEILISEARCH_URL=http://${MEILISEARCH_HOST}:${MEILISEARCH_INTERNAL_PORT}
MEILISEARCH_MASTER_KEY=
MEILI_ENV=development
MEILI_NO_ANALYTICS=true

# =============================================================================
# Ollama (Local LLM Runner)
# =============================================================================
OLLAMA_HOST=ollama.internal
OLLAMA_URL=http://${OLLAMA_HOST}:${OLLAMA_INTERNAL_PORT}
# Model Selection Limits (32GB RAM, CPU-only)
OLLAMA_MAX_PARAMS=13B
OLLAMA_ALLOWED_QUANTS=q4_K_M,q4_K_S,q5_K_M

# =============================================================================
# n8n (Workflow Automation)
# =============================================================================
N8N_HOST=n8n.internal
N8N_PROTOCOL=http
N8N_WEBHOOK_URL=http://${N8N_HOST}:${N8N_INTERNAL_PORT}
N8N_ADMIN_EMAIL=admin@cia.local
N8N_ADMIN_PASSWORD=Admin123
N8N_DB_TYPE=postgresdb
N8N_DB_SCHEMA=n8n
N8N_FUNCTION_ALLOW_EXTERNAL=*
N8N_FUNCTION_ALLOW_BUILTIN=*
N8N_BLOCK_ENV_ACCESS=false
N8N_WORKFLOWS_DIR=/app/workflows

# =============================================================================
# Evolution API (WhatsApp)
# =============================================================================
EVOLUTION_HOST=evolution.internal
EVOLUTION_API_URL=http://${EVOLUTION_HOST}:${EVOLUTION_INTERNAL_PORT}
EVOLUTION_API_KEY=evolution-key
EVOLUTION_DB=evolution
EVOLUTION_DATABASE_PROVIDER=postgresql
EVOLUTION_CACHE_REDIS_ENABLED=true
EVOLUTION_RABBITMQ_ENABLED=false

# =============================================================================
# Configuração da Conta de Email
# =============================================================================
# Email - SMTP (envio)
SMTP_HOST=smtp.hostinger.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_FROM=${EMAIL_FROM}

# Email - POP3 (recebimento)
POP3_HOST=pop.hostinger.com
POP3_PORT=995
POP3_SECURE=true
POP3_POLL_INTERVAL_SECONDS=30

# =============================================================================
# Adminer (Database GUI - apenas dev)
# =============================================================================
ADMINER_DEFAULT_SERVER=${POSTGRES_MAIN_HOST}

# =============================================================================
# Authentication Methods
# =============================================================================
# Identidade (qual campo identifica o usuario)
# Opcoes: email, document-id
AUTH_IDENTITY_METHODS=email,document-id
AUTH_IDENTITY_ENABLED=email

# Validacao (como confirmar identidade)
# Opcoes: password, otp-email, otp-whatsapp
AUTH_VALIDATION_METHODS=password,otp-email,otp-whatsapp
AUTH_VALIDATION_ENABLED=password,otp-email

# OTP Settings
OTP_LENGTH=6
OTP_TTL_MINUTES=5
OTP_MAX_ATTEMPTS=3
OTP_RATE_LIMIT_SECONDS=60

# =============================================================================
# JWT Authentication (Multi-Contexto)
# =============================================================================
# Contexto Team (equipe interna)
JWT_SECRET_TEAM=dev-secret-team-minimum-32-characters-here
JWT_ACCESS_TTL_TEAM=900
JWT_REFRESH_TTL_TEAM=86400
AUTH_COOKIE_ACCESS_TEAM=access-team
AUTH_COOKIE_REFRESH_TEAM=refresh-team

# Contexto Customer (portal do cliente)
JWT_SECRET_CUSTOMER=dev-secret-customer-minimum-32-characters
JWT_ACCESS_TTL_CUSTOMER=900
JWT_REFRESH_TTL_CUSTOMER=604800
AUTH_COOKIE_ACCESS_CUSTOMER=access-customer
AUTH_COOKIE_REFRESH_CUSTOMER=refresh-customer

# Fallback (legado)
JWT_EXPIRES_IN=7d
# JWT_SECRET definido em .env.secrets

# =============================================================================
# Encryption (DES-DATA-010)
# =============================================================================
# ENCRYPTION_KEY definido em .env.secrets

# =============================================================================
# OpenRouter LLM (para Agentes IA)
# =============================================================================
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
OPENROUTER_DEFAULT_MODEL=google/gemini-2.0-flash-001
# OPENROUTER_API_KEY definido em .env.secrets

# =============================================================================
# Rate Limiting
# =============================================================================
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=100

# =============================================================================
# Timezone
# =============================================================================
TZ=America/Sao_Paulo

# =============================================================================
# Logging
# =============================================================================
LOG_LEVEL=info
